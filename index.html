<!DOCTYPE html>
<html lang="en">

<head>
	<meta name="viewport" content="user-scalable=no, initial-scale=1, 
				maximum-scale=1, minimum-scale=1, 
				width=device-width">
	<link rel="stylesheet" href="blogstyle.css">
	<link rel="shortcut icon" href="logo.png" type="image/x-icon">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

	<title>CipherVenom</title>
</head>
<!--init Firebase DB-->

<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
	import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
	import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
	
	// Your web app's Firebase configuration
	const firebaseConfig = {
	  apiKey: "AIzaSyCyoZOZC-u9KNumXybvegpOKz5XvGhyNns",
	  authDomain: "chatapp-1042.firebaseapp.com",
	  databaseURL: "https://chatapp-1042-default-rtdb.firebaseio.com",
	  projectId: "chatapp-1042",
	  storageBucket: "chatapp-1042.appspot.com",
	  messagingSenderId: "949568423483",
	  appId: "1:949568423483:web:5bd6a0e07dfef848bf3e1e",
	  measurementId: "G-PMZJY43K7Z"
	};
  
	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	const analytics = getAnalytics(app);
	const database = getDatabase(app);
  
	document.addEventListener('DOMContentLoaded', function () { 
	  const createPostBtn = document.getElementById('createPostBtn'); 
	  const createPostModal = document.getElementById('createPostModal'); 
	  const closeModal = document.getElementById('closeModal'); 
	  const postForm = document.getElementById('postForm'); 
	  const postSubmitBtn = document.getElementById('postSubmitBtn'); 
	  const postContainer = document.querySelector('.post-container'); 
	  const postDetailModal = document.getElementById('postDetailModal'); 
	  const closeDetailModal = document.getElementById('closeDetailModal'); 
	  const detailTitle = document.getElementById('detailTitle'); 
	  const detailDate = document.getElementById('detailDate'); 
	  const detailDescription = document.getElementById('detailDescription'); 
  
	  createPostBtn.addEventListener('click', function () { 
		  createPostModal.style.display = 'flex'; 
	  }); 
  
	  closeModal.addEventListener('click', function () { 
		  createPostModal.classList.add('fadeOut'); 
		  setTimeout(() => { 
			  createPostModal.style.display = 'none'; 
			  createPostModal.classList.remove('fadeOut'); 
		  }, 500); 
	  }); 
  
	  postForm.addEventListener('submit', function (event) { 
		  event.preventDefault(); 
  
		  const postCategory = document.getElementById('postCategory').value; 
		  const postTitle = document.getElementById('postTitle').value; 
		  const postDescription = document.getElementById('postDescription').value; 
  
		  if (postCategory.trim() === '' || postTitle.trim() === '' || postDescription.trim() === '') { 
			  alert('Please fill out all fields.'); 
			  return; 
		  } 
  
		  const currentDate = new Date(); 
		  const day = currentDate.getDate(); 
		  const month = currentDate.toLocaleString('default', { month: 'short' }); 
		  const year = currentDate.getFullYear(); 
		  const formattedDate = day + ' ' + month + ' ' + year; 
  
		  const postId = push(ref(database, 'posts')).key;
		  const newPost = {
			  id: postId,
			  category: postCategory,
			  title: postTitle,
			  description: postDescription,
			  date: formattedDate
		  };
  
		  set(ref(database, 'posts/' + postId), newPost).then(() => {
			  const postElement = document.createElement('div'); 
			  postElement.className = 'post-box'; 
			  postElement.innerHTML = `
				  <h1 class="post-title" data-title="${postTitle}" data-date="${formattedDate}" data-description="${postDescription}">${postTitle}</h1><br>
				  <h2 class="category">${postCategory}</h2><br>
				  <span class="post-date">${formattedDate}</span>
				  <p class="post-description">${postDescription.substring(0, 100)}...</p>
				  <button class="delete-post" data-id="${postId}">Delete</button>
				  <span class="load-more" data-title="${postTitle}" data-date="${formattedDate}" data-description="${postDescription}">Load more</span>
			  `;
  
			  postContainer.insertBefore(postElement, postContainer.firstChild);
			  const postCreatedMessage = document.getElementById('postCreatedMessage'); 
			  postCreatedMessage.style.display = 'block'; 
			  createPostModal.style.display = 'none'; 
			  postForm.reset(); 
			  setTimeout(() => { 
				  postCreatedMessage.style.display = 'none'; 
			  }, 3000);
		  }).catch((error) => {
			  alert('Error: ' + error.message);
		  });
	  }); 
  
	  postContainer.addEventListener('click', function (event) { 
		  if (event.target.classList.contains('load-more') || event.target.classList.contains('post-title')) { 
			  const title = event.target.getAttribute('data-title'); 
			  const date = event.target.getAttribute('data-date'); 
			  const description = event.target.getAttribute('data-description'); 
			  detailTitle.textContent = title; 
			  detailDate.textContent = date; 
			  detailDescription.textContent = description; 
			  postDetailModal.style.display = 'flex'; 
		  } 
  
		  if (event.target.classList.contains('delete-post')) { 
			  const postId = event.target.getAttribute('data-id'); 
			  remove(ref(database, 'posts/' + postId)).then(() => {
				  const postToDelete = event.target.closest('.post-box'); 
				  postToDelete.classList.add('fadeOut'); 
				  setTimeout(() => { 
					  postContainer.removeChild(postToDelete); 
				  }, 500);
			  }).catch((error) => {
				  alert('Error: ' + error.message);
			  });
		  } 
	  }); 
  
	  closeDetailModal.addEventListener('click', function () { 
		  postDetailModal.classList.add('fadeOut'); 
		  setTimeout(() => { 
			  postDetailModal.style.display = 'none'; 
			  postDetailModal.classList.remove('fadeOut'); 
		  }, 500); 
	  }); 
  
	  onValue(ref(database, 'posts'), (snapshot) => {
		  postContainer.innerHTML = ''; // Clear existing posts
		  const posts = snapshot.val();
		  if (posts) {
			  Object.values(posts).forEach(post => {
				  const postElement = document.createElement('div'); 
				  postElement.className = 'post-box'; 
				  postElement.innerHTML = `
					  <h1 class="post-title" data-title="${post.title}" data-date="${post.date}" data-description="${post.description}">${post.title}</h1><br>
					  <h2 class="category">${post.category}</h2><br>
					  <span class="post-date">${post.date}</span>
					  <p class="post-description">${post.description.substring(0, 100)}...</p>
					  <button class="delete-post" data-id="${post.id}">Delete</button>
					  <span class="load-more" data-title="${post.title}" data-date="${post.date}" data-description="${post.description}">Load more</span>
				  `;
				  postContainer.appendChild(postElement);
			  });
		  }
	  });
	});
  </script>
  
<body>
	<header class="bg-dark text-white p-3" id="head">
		<nav class="navbar navbar-expand-lg navbar-dark container">
			<a class="navbar-brand" href="#">
				<h3>ℂ𝕚𝕡𝕙𝕖𝕣𝕍𝕖𝕟𝕠𝕞</h3>
			</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a class="nav-link" href="/">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="cv.html">About</a></li>
					<li class="nav-item"><a class="nav-link" href="#" id="createPostBtn">Create Post</a></li>
					<li class="nav-item"><a class="nav-link" href="tel: +919994021042">Contact</a></li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="projectsDropdown" role="button"
							data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Other Apps</a>
						<div class="dropdown-menu" aria-labelledby="projectsDropdown">
							<a class="dropdown-item" href="https://bit.ly/3wfL1Lv?r=lp">DailyDairy.com</a>
							<a class="dropdown-item" href="http://cloud-convo.netlify.app">cloud-convo.com</a>
							<!-- <a class="dropdown-item" href="#">Project 3</a> -->
						</div>
					</li>
				</ul>
			</div>
		</nav>
	</header>

	<main class="post-container">


		<div id="createPostModal" class="modal">
			<div class="modal-content">
				<span class="close" id="closeModal">×</span>
				<h2>Create a New Post</h2>
				<form id="postForm">
					<div class="upper">
						<div class="title">
							<label class="postheading" for="postTitle">
								Title
							</label>
							<input type="text" class="postTitle" id="postTitle" name="postTitle" autocomplete="off"
								required>
						</div>
						<div class="category1">
							<label class="postheading" for="postCategory">
								Category
							</label>
							<input type="text" class="postCategory" id="postCategory" name="postCategory"
								autocomplete="off" required>
						</div>
					</div>

					<label class="postheading" for="postDescription">
						Description
					</label>
					<textarea class="postDescription" id="postDescription" name="postDescription" autocomplete="off"
						required>
					</textarea>

					<button type="submit" id="postSubmitBtn" class="postSubmitBtn">Post</button>
				</form>
			</div>
		</div>

		<!-- Detail Modal -->
		<div id="postDetailModal" class="modal">
			<div class="modal-content">
				<span class="close" id="closeDetailModal">

				</span>
				<h1 id="detailTitle"></h1>
				<span id="detailDate"></span>
				<p id="detailDescription"></p>
			</div>
		</div>

		<div id="postCreatedMessage" class="post-message">
			Post created successfully!
		</div>

	</main>

	<footer class="bg-dark text-white py-4">
		<div class="container text-center">
			<div class="row">
				<div class="col-md-6">
					<p class="description">Unleash your potential</p>
				</div>
				<div class="col-md-6">
					<p class="copyright">© 2024 CipherVenom</p>
				</div>
			</div>
		</div>
	</footer>

	<!-- JavaScript file linked -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<script src="blogscript.js"></script>
</body>

</html>